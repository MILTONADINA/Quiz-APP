<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Quiz App - Interactive Frontend</title>

  <!-- Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      /* Theme (no pink/blue) */
      --bg: #F7F7F8;          /* subtle app background */
      --card: #FFFFFF;        /* card/frame background */
      --ink: #111827;         /* primary text */
      --muted: #E5E7EB;       /* light rails */
      --primary: #16A34A;     /* Emerald 600 */
      --primary-700: #15803D; /* Emerald 700 */
      --secondary: #F59E0B;   /* Amber 500 */
      --accent: #EF4444;      /* Red 500 */
      --neutral: #334155;     /* Slate 700 */
    }
    html, body { font-family: "Roboto", system-ui, -apple-system, Segoe UI, Helvetica, Arial, sans-serif; }
    body { background: var(--bg); color: var(--ink); }

    /* Main app container */
    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Page styling */
    .page {
      display: none;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }
    .page.active {
      display: block;
    }

    /* Inputs/selects/textarea: subtle, clean */
    .input, .select, .textarea {
      width: 100%;
      background: #F3F4F6;        /* gray-100 */
      border: 1px solid var(--muted);
      border-radius: 12px;
      padding: 0.5rem 0.75rem;
      color: var(--ink);
      outline: none;
      transition: box-shadow 120ms ease, border-color 120ms ease;
    }
    .input:focus, .select:focus, .textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.18); /* emerald focus, not blue */
    }

    /* Buttons: rounded, NO BORDERS */
    .btn { 
      border-radius: 12px; 
      padding: 0.625rem 1rem; 
      font-weight: 600; 
      border: none;            /* <â€” ensure no button borders */
      outline: none; 
      cursor: pointer;
      transition: all 120ms ease;
    }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-700); }
    .btn-primary:disabled { background: #9CA3AF; cursor: not-allowed; }
    .btn-neutral { background: #F3F4F6; color: var(--ink); }
    .btn-neutral:hover { background: #EDEEF0; }
    .btn-danger { background: var(--accent); color: #fff; }
    .btn-danger:hover { filter: brightness(0.95); }

    .badge {
      display: inline-block;
      background: #F1F5F9;        /* slate-100 */
      color: var(--neutral);
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid var(--muted);
    }

    /* Progress rail (no blue) */
    .rail { background: #E5E7EB; border-radius: 999px; height: 0.5rem; width: 100%; }
    .fill { background: var(--primary); height: 100%; border-radius: 999px; transition: width 0.3s ease; }

    /* Quiz card styling */
    .quiz-card {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(2, 6, 23, 0.06);
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .quiz-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(2, 6, 23, 0.1);
    }

    /* Question styling */
    .question-container {
      background: #F3F4F6;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    /* Option styling */
    .option {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      background: #F9FAFB;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .option:hover {
      background: #F3F4F6;
    }
    .option.selected {
      background: rgba(22, 163, 74, 0.1);
      border: 2px solid var(--primary);
    }

    /* Timer styling */
    .timer {
      font-weight: 600;
      color: var(--accent);
    }

    /* Results styling */
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: #F3F4F6;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .page {
        padding: 1rem;
      }
      .quiz-card {
        padding: 1rem;
      }
    }
  </style>
</head>
<body class="app-container">
  <!-- Navigation Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <h1 class="text-xl font-bold text-gray-900">Quiz App</h1>
        <div id="user-info" class="hidden">
          <span id="user-name" class="text-sm text-gray-600 mr-3"></span>
          <button id="logout-btn" class="btn btn-danger text-sm">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1">
    <!-- Student Login Page -->
    <div id="student-login" class="page active">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6 text-center">Student Login</h2>
        <form id="student-login-form">
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Username</label>
            <input type="text" id="student-username" class="input" placeholder="Enter your username" required />
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Password</label>
            <input type="password" id="student-password" class="input" placeholder="Enter your password" required />
          </div>
          <button type="submit" class="btn btn-primary w-full mb-4">Login</button>
          <div class="text-center">
            <button type="button" id="switch-to-prof" class="text-sm text-blue-600 hover:underline">Switch to Professor Login</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Professor Login Page -->
    <div id="professor-login" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6 text-center">Professor Login</h2>
        <form id="professor-login-form">
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Username</label>
            <input type="text" id="prof-username" class="input" placeholder="Enter your username" required />
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Password</label>
            <input type="password" id="prof-password" class="input" placeholder="Enter your password" required />
          </div>
          <button type="submit" class="btn btn-primary w-full mb-4">Login</button>
          <div class="text-center">
            <button type="button" id="switch-to-student" class="text-sm text-blue-600 hover:underline">Switch to Student Login</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Join Quiz Page -->
    <div id="join-quiz" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6 text-center">Join Quiz</h2>
        <div class="bg-gray-100 rounded-xl p-8 text-center mb-6">
          <div class="text-4xl mb-3">ðŸ“·</div>
          <p class="text-lg font-medium">Scan QR Code</p>
        </div>
        <div class="text-center mb-6">
          <span class="text-gray-500">OR</span>
        </div>
        <form id="join-quiz-form">
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Enter Quiz PIN</label>
            <input type="text" id="quiz-pin" class="input text-center text-lg" placeholder="Enter 6-digit PIN" maxlength="6" required />
          </div>
          <button type="submit" class="btn btn-primary w-full">Join Quiz</button>
        </form>
      </div>
    </div>

    <!-- Student Home Page -->
    <div id="student-home" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">Available Quizzes</h2>
        <div id="available-quizzes">
          <div class="quiz-card bg-gray-50 hover:bg-gray-100 cursor-pointer" data-quiz-id="1">
            <h3 class="font-bold text-lg mb-2">Database Fundamentals</h3>
            <p class="text-gray-600">10 questions â€¢ 15 minutes</p>
            <div class="mt-3">
              <span class="badge">Multiple Choice</span>
              <span class="badge ml-2">True/False</span>
            </div>
          </div>
          <div class="quiz-card bg-gray-50 hover:bg-gray-100 cursor-pointer" data-quiz-id="2">
            <h3 class="font-bold text-lg mb-2">Math Quiz #3</h3>
            <p class="text-gray-600">8 questions â€¢ 12 minutes</p>
            <div class="mt-3">
              <span class="badge">Multiple Choice</span>
            </div>
          </div>
          <div class="quiz-card bg-gray-50 hover:bg-gray-100 cursor-pointer" data-quiz-id="3">
            <h3 class="font-bold text-lg mb-2">History Review</h3>
            <p class="text-gray-600">15 questions â€¢ 20 minutes</p>
            <div class="mt-3">
              <span class="badge">Multiple Choice</span>
              <span class="badge ml-2">Free Response</span>
            </div>
          </div>
        </div>
        <div class="mt-6 text-center">
          <button id="join-new-quiz" class="btn btn-primary">Join New Quiz</button>
        </div>
      </div>
    </div>

    <!-- Quiz Question Page -->
    <div id="quiz-question" class="page">
      <div class="quiz-card">
        <div class="flex justify-between items-center mb-6">
          <span class="badge" id="question-counter">Q1 of 10</span>
          <span class="badge timer" id="question-timer">2:45</span>
        </div>
        
        <div class="question-container">
          <h3 class="text-lg font-medium" id="question-text">What is a primary key in a database?</h3>
        </div>

        <div id="question-options" class="mb-6">
          <!-- Options will be dynamically generated -->
        </div>

        <div class="flex gap-3">
          <button id="submit-answer" class="btn btn-primary flex-1" disabled>Submit Answer</button>
          <button id="next-question" class="btn btn-neutral flex-1" style="display: none;">Next Question</button>
        </div>

        <div class="mt-4">
          <div class="rail">
            <div class="fill" id="quiz-progress" style="width: 10%;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Student Results Page -->
    <div id="student-results" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6 text-center">Quiz Results</h2>
        
        <div class="bg-gray-100 rounded-xl p-6 text-center mb-6">
          <div class="text-4xl font-bold text-green-600 mb-2" id="final-score">7/10</div>
          <p class="text-lg" id="score-percentage">You scored 70%</p>
        </div>

        <div id="question-results" class="mb-6">
          <!-- Results will be dynamically generated -->
        </div>

        <div class="flex gap-3">
          <button id="view-history" class="btn btn-neutral flex-1">View My Quizzes</button>
          <button id="exit-quiz" class="btn btn-primary flex-1">Exit</button>
        </div>
      </div>
    </div>

    <!-- Student History Page -->
    <div id="student-history" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">My Quiz History</h2>
        
        <div id="quiz-history">
          <div class="quiz-card bg-gray-50 mb-3">
            <h3 class="font-bold text-lg mb-2">Database Fundamentals</h3>
            <p class="text-gray-600 mb-1">March 15, 2024</p>
            <p class="text-green-600 font-semibold">Score: 85%</p>
          </div>
          <div class="quiz-card bg-gray-50 mb-3">
            <h3 class="font-bold text-lg mb-2">Math Quiz #2</h3>
            <p class="text-gray-600 mb-1">March 12, 2024</p>
            <p class="text-green-600 font-semibold">Score: 92%</p>
          </div>
          <div class="quiz-card bg-gray-50">
            <h3 class="font-bold text-lg mb-2">History Review</h3>
            <p class="text-gray-600 mb-1">March 10, 2024</p>
            <p class="text-green-600 font-semibold">Score: 78%</p>
          </div>
        </div>

        <div class="mt-6 text-center">
          <button id="back-to-home" class="btn btn-primary">Back to Home</button>
        </div>
      </div>
    </div>

    <!-- Professor Home Page -->
    <div id="professor-home" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">My Classes</h2>
        
        <div id="professor-classes">
          <div class="quiz-card bg-gray-50 hover:bg-gray-100 cursor-pointer mb-3" data-class-id="1">
            <h3 class="font-bold text-lg mb-2">Database Systems</h3>
            <p class="text-gray-600">CS 4320 â€¢ 45 students</p>
          </div>
          <div class="quiz-card bg-gray-50 hover:bg-gray-100 cursor-pointer mb-3" data-class-id="2">
            <h3 class="font-bold text-lg mb-2">Advanced Mathematics</h3>
            <p class="text-gray-600">MATH 3010 â€¢ 32 students</p>
          </div>
          <div class="quiz-card bg-gray-50 hover:bg-gray-100 cursor-pointer" data-class-id="3">
            <h3 class="font-bold text-lg mb-2">World History</h3>
            <p class="text-gray-600">HIST 2100 â€¢ 28 students</p>
          </div>
        </div>

        <div class="mt-6 text-center">
          <button id="quiz-management" class="btn btn-primary">Quiz Management</button>
        </div>
      </div>
    </div>

    <!-- Quiz Management Page -->
    <div id="quiz-management" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">Quiz Management</h2>
        
        <div class="space-y-3">
          <button id="create-quiz" class="btn btn-primary w-full">Create New Quiz</button>
          <button id="search-edit-quiz" class="btn btn-neutral w-full">Search/Edit Quiz</button>
          <button id="start-live-quiz" class="btn btn-neutral w-full">Start Live Quiz</button>
          <button id="view-results" class="btn btn-neutral w-full">View Results & Stats</button>
        </div>
      </div>
    </div>

    <!-- Create Quiz Page -->
    <div id="create-quiz-page" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">Create Quiz</h2>
        
        <form id="create-quiz-form">
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Subject/Class</label>
            <select id="quiz-subject" class="select" required>
              <option value="">Select a class</option>
              <option value="Database Systems">Database Systems</option>
              <option value="Advanced Mathematics">Advanced Mathematics</option>
              <option value="World History">World History</option>
            </select>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Question Type</label>
            <select id="question-type" class="select" required>
              <option value="">Select question type</option>
              <option value="multiple-choice">Multiple Choice</option>
              <option value="multiple-select">Multiple Select</option>
              <option value="true-false">True/False</option>
              <option value="free-response">Free Response</option>
            </select>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Question</label>
            <textarea id="question-text" class="textarea h-24" placeholder="Enter your question..." required></textarea>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Timer (minutes)</label>
            <input type="number" id="question-timer" class="input" min="1" max="60" value="5" required />
          </div>

          <div class="flex gap-3">
            <button type="submit" class="btn btn-primary flex-1">Save Question</button>
            <button type="button" id="cancel-create" class="btn btn-neutral flex-1">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Live Quiz Control Page -->
    <div id="live-quiz-control" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">Live Quiz Control</h2>
        
        <div class="bg-gray-100 rounded-xl p-4 mb-6">
          <h3 class="font-bold text-lg mb-2" id="live-quiz-title">Database Fundamentals Quiz</h3>
          <p id="live-quiz-progress">Q2 of 10 â€¢ 2:45 remaining</p>
          <div class="rail mt-3">
            <div class="fill" id="live-progress" style="width: 20%;"></div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-4">
          <button id="prev-question" class="btn btn-primary">Previous</button>
          <button id="next-question-live" class="btn btn-primary">Next</button>
          <button id="pause-quiz" class="btn btn-neutral">Pause</button>
          <button id="resume-quiz" class="btn btn-neutral" style="display: none;">Resume</button>
        </div>

        <button id="end-quiz" class="btn btn-danger w-full mb-4">End Quiz</button>
        
        <div class="text-center bg-gray-100 rounded-xl p-3">
          <span id="connected-students">32 students connected</span>
        </div>
      </div>
    </div>

    <!-- Live Results Page -->
    <div id="live-results" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">Live Results</h2>
        
        <div class="question-container mb-6">
          <h3 class="text-lg font-medium" id="live-question-text">What is a primary key in a database?</h3>
        </div>

        <div id="live-results-content">
          <!-- Live results will be dynamically generated -->
        </div>

        <div class="text-center bg-gray-100 rounded-xl p-3 mt-4">
          <span id="response-count">32 students responded</span>
        </div>
      </div>
    </div>

    <!-- Final Results Page -->
    <div id="final-results" class="page">
      <div class="quiz-card">
        <h2 class="text-2xl font-bold mb-6">Final Results & Stats</h2>
        
        <div class="bg-gray-100 rounded-xl p-6 text-center mb-6">
          <div class="text-4xl font-bold text-green-600 mb-2" id="class-average">78%</div>
          <p class="text-lg">Class Average</p>
        </div>

        <div id="question-stats" class="mb-6">
          <!-- Question statistics will be dynamically generated -->
        </div>

        <div class="grid grid-cols-2 gap-3 mb-4">
          <button id="export-pdf" class="btn btn-primary">Export PDF</button>
          <button id="export-csv" class="btn btn-neutral">Export CSV</button>
        </div>
        
        <button id="view-individual" class="btn btn-neutral w-full mb-3">View Individual Responses (Private)</button>
        <button id="exit-live-quiz" class="btn btn-primary w-full">Exit</button>
      </div>
    </div>

  </main>

  <!-- JavaScript -->
  <script>
    // App State
    const appState = {
      currentUser: null,
      currentPage: 'student-login',
      currentQuiz: null,
      currentQuestion: 0,
      userAnswers: [],
      quizTimer: null,
      questionTimer: null
    };

    // Sample Data
    const sampleQuizzes = {
      1: {
        id: 1,
        title: "Database Fundamentals",
        questions: [
          {
            id: 1,
            type: "multiple-choice",
            question: "What is a primary key in a database?",
            options: [
              "A key that opens the database",
              "A unique identifier for records",
              "The first column in a table",
              "A password for security"
            ],
            correct: 1,
            timer: 3
          },
          {
            id: 2,
            type: "multiple-select",
            question: "Which are SQL commands? (Select all that apply)",
            options: ["SELECT", "INSERT", "PRINT", "UPDATE"],
            correct: [0, 1, 3],
            timer: 2
          },
          {
            id: 3,
            type: "true-false",
            question: "A foreign key can reference multiple tables simultaneously.",
            options: ["True", "False"],
            correct: 1,
            timer: 2
          }
        ]
      }
    };

    // Utility Functions
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      appState.currentPage = pageId;
    }

    function showUserInfo(user) {
      appState.currentUser = user;
      document.getElementById('user-name').textContent = user.name;
      document.getElementById('user-info').classList.remove('hidden');
    }

    function hideUserInfo() {
      appState.currentUser = null;
      document.getElementById('user-info').classList.add('hidden');
    }

    function startTimer(duration, displayElement, onComplete) {
      let timer = duration;
      const interval = setInterval(() => {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        displayElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (--timer < 0) {
          clearInterval(interval);
          if (onComplete) onComplete();
        }
      }, 1000);
      return interval;
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Login forms
      document.getElementById('student-login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('student-username').value;
        const password = document.getElementById('student-password').value;
        
        if (username && password) {
          showUserInfo({ name: username, type: 'student' });
          showPage('student-home');
        }
      });

      document.getElementById('professor-login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('prof-username').value;
        const password = document.getElementById('prof-password').value;
        
        if (username && password) {
          showUserInfo({ name: username, type: 'professor' });
          showPage('professor-home');
        }
      });

      // Switch between login types
      document.getElementById('switch-to-prof').addEventListener('click', () => showPage('professor-login'));
      document.getElementById('switch-to-student').addEventListener('click', () => showPage('student-login'));

      // Student navigation
      document.getElementById('join-new-quiz').addEventListener('click', () => showPage('join-quiz'));
      document.getElementById('join-quiz-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const pin = document.getElementById('quiz-pin').value;
        if (pin === '123456') {
          appState.currentQuiz = sampleQuizzes[1];
          appState.currentQuestion = 0;
          appState.userAnswers = [];
          showPage('quiz-question');
          loadQuestion();
        } else {
          alert('Invalid PIN. Try 123456 for demo.');
        }
      });

      // Quiz management
      document.getElementById('quiz-management').addEventListener('click', () => showPage('quiz-management'));
      document.getElementById('create-quiz').addEventListener('click', () => showPage('create-quiz-page'));
      document.getElementById('start-live-quiz').addEventListener('click', () => showPage('live-quiz-control'));

      // Logout
      document.getElementById('logout-btn').addEventListener('click', () => {
        hideUserInfo();
        showPage('student-login');
      });

      // Back navigation
      document.getElementById('back-to-home').addEventListener('click', () => {
        if (appState.currentUser?.type === 'student') {
          showPage('student-home');
        } else {
          showPage('professor-home');
        }
      });

      // Cancel create quiz
      document.getElementById('cancel-create').addEventListener('click', () => showPage('quiz-management'));

      // Create quiz form
      document.getElementById('create-quiz-form').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Quiz question saved! (Demo mode)');
        showPage('quiz-management');
      });

      // Available quizzes click
      document.querySelectorAll('[data-quiz-id]').forEach(card => {
        card.addEventListener('click', () => {
          const quizId = card.dataset.quizId;
          appState.currentQuiz = sampleQuizzes[quizId];
          appState.currentQuestion = 0;
          appState.userAnswers = [];
          showPage('quiz-question');
          loadQuestion();
        });
      });
    });

    // Quiz Functions
    function loadQuestion() {
      const quiz = appState.currentQuiz;
      const question = quiz.questions[appState.currentQuestion];
      
      document.getElementById('question-counter').textContent = `Q${appState.currentQuestion + 1} of ${quiz.questions.length}`;
      document.getElementById('question-text').textContent = question.question;
      document.getElementById('quiz-progress').style.width = `${((appState.currentQuestion + 1) / quiz.questions.length) * 100}%`;
      
      // Start timer
      if (appState.questionTimer) clearInterval(appState.questionTimer);
      appState.questionTimer = startTimer(question.timer * 60, document.getElementById('question-timer'), () => {
        submitAnswer();
      });

      // Generate options
      const optionsContainer = document.getElementById('question-options');
      optionsContainer.innerHTML = '';
      
      if (question.type === 'multiple-choice' || question.type === 'true-false') {
        question.options.forEach((option, index) => {
          const optionDiv = document.createElement('div');
          optionDiv.className = 'option';
          optionDiv.innerHTML = `
            <input type="radio" name="answer" value="${index}" class="mr-3">
            <span>${option}</span>
          `;
          optionDiv.addEventListener('click', () => {
            optionDiv.querySelector('input').checked = true;
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            optionDiv.classList.add('selected');
            document.getElementById('submit-answer').disabled = false;
          });
          optionsContainer.appendChild(optionDiv);
        });
      } else if (question.type === 'multiple-select') {
        question.options.forEach((option, index) => {
          const optionDiv = document.createElement('div');
          optionDiv.className = 'option';
          optionDiv.innerHTML = `
            <input type="checkbox" name="answer" value="${index}" class="mr-3">
            <span>${option}</span>
          `;
          optionDiv.addEventListener('click', () => {
            const checkbox = optionDiv.querySelector('input');
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
              optionDiv.classList.add('selected');
            } else {
              optionDiv.classList.remove('selected');
            }
            document.getElementById('submit-answer').disabled = false;
          });
          optionsContainer.appendChild(optionDiv);
        });
      } else if (question.type === 'free-response') {
        const textarea = document.createElement('textarea');
        textarea.className = 'textarea h-32';
        textarea.placeholder = 'Type your answer...';
        textarea.addEventListener('input', () => {
          document.getElementById('submit-answer').disabled = false;
        });
        optionsContainer.appendChild(textarea);
      }

      document.getElementById('submit-answer').disabled = true;
      document.getElementById('next-question').style.display = 'none';
    }

    function submitAnswer() {
      const question = appState.currentQuiz.questions[appState.currentQuestion];
      let answer = [];

      if (question.type === 'multiple-choice' || question.type === 'true-false') {
        const selected = document.querySelector('input[name="answer"]:checked');
        if (selected) answer = [parseInt(selected.value)];
      } else if (question.type === 'multiple-select') {
        const selected = document.querySelectorAll('input[name="answer"]:checked');
        answer = Array.from(selected).map(input => parseInt(input.value));
      } else if (question.type === 'free-response') {
        const textarea = document.querySelector('textarea');
        answer = [textarea.value];
      }

      appState.userAnswers.push({
        questionId: question.id,
        answer: answer,
        correct: checkAnswer(question, answer)
      });

      if (appState.currentQuestion < appState.currentQuiz.questions.length - 1) {
        document.getElementById('submit-answer').style.display = 'none';
        document.getElementById('next-question').style.display = 'block';
      } else {
        showResults();
      }
    }

    function checkAnswer(question, answer) {
      if (question.type === 'multiple-choice' || question.type === 'true-false') {
        return answer[0] === question.correct;
      } else if (question.type === 'multiple-select') {
        return JSON.stringify(answer.sort()) === JSON.stringify(question.correct.sort());
      }
      return true; // Free response always correct for demo
    }

    function showResults() {
      const correct = appState.userAnswers.filter(a => a.correct).length;
      const total = appState.userAnswers.length;
      const percentage = Math.round((correct / total) * 100);

      document.getElementById('final-score').textContent = `${correct}/${total}`;
      document.getElementById('score-percentage').textContent = `You scored ${percentage}%`;

      const resultsContainer = document.getElementById('question-results');
      resultsContainer.innerHTML = '';
      
      appState.userAnswers.forEach((result, index) => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'result-item';
        resultDiv.innerHTML = `
          <span>Q${index + 1}: ${appState.currentQuiz.questions[index].question.substring(0, 30)}...</span>
          <span>${result.correct ? 'âœ“' : 'âœ—'}</span>
        `;
        resultsContainer.appendChild(resultDiv);
      });

      showPage('student-results');
    }

    // Submit answer button
    document.getElementById('submit-answer').addEventListener('click', submitAnswer);
    
    // Next question button
    document.getElementById('next-question').addEventListener('click', () => {
      appState.currentQuestion++;
      loadQuestion();
    });

    // Results navigation
    document.getElementById('view-history').addEventListener('click', () => showPage('student-history'));
    document.getElementById('exit-quiz').addEventListener('click', () => showPage('student-home'));

    // Live quiz controls
    document.getElementById('pause-quiz').addEventListener('click', () => {
      document.getElementById('pause-quiz').style.display = 'none';
      document.getElementById('resume-quiz').style.display = 'block';
    });

    document.getElementById('resume-quiz').addEventListener('click', () => {
      document.getElementById('resume-quiz').style.display = 'none';
      document.getElementById('pause-quiz').style.display = 'block';
    });

    document.getElementById('end-quiz').addEventListener('click', () => {
      showPage('final-results');
    });

    // Export functions
    document.getElementById('export-pdf').addEventListener('click', () => {
      alert('PDF export functionality would be implemented here');
    });

    document.getElementById('export-csv').addEventListener('click', () => {
      alert('CSV export functionality would be implemented here');
    });

    document.getElementById('exit-live-quiz').addEventListener('click', () => {
      showPage('professor-home');
    });
  </script>
</body>
</html>
